{% extends 'base.html' %}
{% load static %}

{% block title %}Créer votre établissement{% endblock %}

{% block extra_css %}
<style>
    .creation-etablissement-container {
        max-width: 800px;
        margin: 2rem auto;
        padding: 2rem;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .info-demande {
        background: #e3f2fd;
        border: 1px solid #2196f3;
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 2rem;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-control {
        border-radius: 6px;
        border: 1px solid #ced4da;
        padding: 0.75rem;
    }
    
    .form-control:focus {
        border-color: #007bff;
        box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #007bff, #0056b3);
        border: none;
        padding: 0.75rem 2rem;
        border-radius: 6px;
        font-weight: 500;
    }
    
    .required {
        color: #dc3545;
    }
    
    .form-section {
        border: 1px solid #e9ecef;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 2rem;
        background: #f8f9fa;
    }
    
    .form-section h4 {
        color: #495057;
        margin-bottom: 1rem;
        border-bottom: 2px solid #007bff;
        padding-bottom: 0.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="creation-etablissement-container">
        <div class="text-center mb-4">
            <h2><i class="fas fa-school"></i> Créer votre établissement scolaire</h2>
            <p class="text-muted">Finalisez la création de votre établissement</p>
        </div>

        <!-- Informations de la demande -->
        <div class="info-demande">
            <h5><i class="fas fa-info-circle"></i> Informations de votre demande</h5>
            <div class="row">
                <div class="col-md-6">
                    <strong>Demandeur:</strong> {{ demande.prenom_demandeur }} {{ demande.nom_demandeur }}<br>
                    <strong>Fonction:</strong> {{ demande.fonction_demandeur }}<br>
                    <strong>Email:</strong> {{ demande.email_demandeur }}
                </div>
                <div class="col-md-6">
                    <strong>École demandée:</strong> {{ demande.nom_ecole }}<br>
                    <strong>Type:</strong> {{ demande.get_type_ecole_display }}<br>
                    <strong>Ville:</strong> {{ demande.ville }}
                </div>
            </div>
        </div>

        <form method="post" id="creation-etablissement-form">
            {% csrf_token %}
            
            <!-- Informations générales -->
            <div class="form-section">
                <h4><i class="fas fa-building"></i> Informations générales</h4>
                
                <div class="row">
                    <div class="col-md-8">
                        <div class="form-group">
                            <label for="nom_ecole" class="form-label">
                                <i class="fas fa-school"></i> Nom de l'établissement <span class="required">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="nom_ecole" 
                                   name="nom_ecole" 
                                   value="{{ demande.nom_ecole }}"
                                   required>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label for="type_ecole" class="form-label">
                                <i class="fas fa-tag"></i> Type <span class="required">*</span>
                            </label>
                            <select class="form-control" id="type_ecole" name="type_ecole" required>
                                <option value="PUBLIQUE" {% if demande.type_ecole == 'PUBLIQUE' %}selected{% endif %}>École Publique</option>
                                <option value="PRIVEE" {% if demande.type_ecole == 'PRIVEE' %}selected{% endif %}>École Privée</option>
                                <option value="COMMUNAUTAIRE" {% if demande.type_ecole == 'COMMUNAUTAIRE' %}selected{% endif %}>École Communautaire</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="nom_complet" class="form-label">
                        <i class="fas fa-file-alt"></i> Nom complet officiel
                    </label>
                    <input type="text" 
                           class="form-control" 
                           id="nom_complet" 
                           name="nom_complet" 
                           value="{{ demande.nom_complet_ecole }}"
                           placeholder="Nom complet tel qu'il apparaît sur les documents officiels">
                </div>
            </div>

            <!-- Localisation -->
            <div class="form-section">
                <h4><i class="fas fa-map-marker-alt"></i> Localisation</h4>
                
                <div class="form-group">
                    <label for="adresse" class="form-label">
                        <i class="fas fa-home"></i> Adresse complète <span class="required">*</span>
                    </label>
                    <textarea class="form-control" 
                              id="adresse" 
                              name="adresse" 
                              rows="2" 
                              required>{{ demande.adresse_ecole }}</textarea>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="ville" class="form-label">
                                <i class="fas fa-city"></i> Ville <span class="required">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="ville" 
                                   name="ville" 
                                   value="{{ demande.ville }}"
                                   required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="prefecture" class="form-label">
                                <i class="fas fa-map"></i> Préfecture <span class="required">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="prefecture" 
                                   name="prefecture" 
                                   value="{{ demande.prefecture }}"
                                   required>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Contact -->
            <div class="form-section">
                <h4><i class="fas fa-phone"></i> Informations de contact</h4>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="telephone" class="form-label">
                                <i class="fas fa-phone"></i> Téléphone principal <span class="required">*</span>
                            </label>
                            <input type="tel" 
                                   class="form-control" 
                                   id="telephone" 
                                   name="telephone" 
                                   value="{{ demande.telephone_ecole }}"
                                   placeholder="+224XXXXXXXXX"
                                   required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="email" class="form-label">
                                <i class="fas fa-envelope"></i> Email officiel <span class="required">*</span>
                            </label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   value="{{ demande.email_ecole }}"
                                   required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="site_web" class="form-label">
                        <i class="fas fa-globe"></i> Site web
                    </label>
                    <input type="url" 
                           class="form-control" 
                           id="site_web" 
                           name="site_web" 
                           value="{{ demande.site_web }}"
                           placeholder="https://www.votre-ecole.com">
                </div>
            </div>

            <!-- Direction -->
            <div class="form-section">
                <h4><i class="fas fa-user-tie"></i> Direction</h4>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="directeur" class="form-label">
                                <i class="fas fa-user"></i> Nom du directeur <span class="required">*</span>
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="directeur" 
                                   name="directeur" 
                                   value="{{ demande.nom_directeur }}"
                                   required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label for="directeur_telephone" class="form-label">
                                <i class="fas fa-phone"></i> Téléphone du directeur
                            </label>
                            <input type="tel" 
                                   class="form-control" 
                                   id="directeur_telephone" 
                                   name="directeur_telephone" 
                                   value="{{ demande.telephone_directeur }}"
                                   placeholder="+224XXXXXXXXX">
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">
                    <i class="fas fa-check"></i> Créer mon établissement
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('creation-etablissement-form');
    
    // Validation du formulaire
    form.addEventListener('submit', function(e) {
        const requiredFields = form.querySelectorAll('[required]');
        let isValid = true;
        
        requiredFields.forEach(field => {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                isValid = false;
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        if (!isValid) {
            e.preventDefault();
            alert('Veuillez remplir tous les champs obligatoires.');
        }
    });
    
    // Validation du téléphone
    const phoneFields = document.querySelectorAll('input[type="tel"]');
    phoneFields.forEach(field => {
        field.addEventListener('input', function() {
            const phoneRegex = /^\+224\d{8,9}$/;
            if (this.value && !phoneRegex.test(this.value)) {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
            }
        });
    });
});
</script>
{% endblock %}
